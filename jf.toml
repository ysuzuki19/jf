[meta]
version = "0.1.0"

[job.setup-dev]
mode = "shell"
script = """
cargo install cargo-binstall
cargo binstall cargo-llvm-cov
"""

[job.install]
mode = "sequential"
jobs = ["only-test", "only-install"]

[job.uninstall]
command = "cargo"
args = ["uninstall"]

[job.update]
mode = "sequential"
jobs = ["git-pull", "install"]

[job.live-llvm-cov]
mode = "watch"
job = "llvm-cov"
watch_list = ["src/**", "Cargo.toml"]

[job."llvm-cov:term"]
command = "cargo"
args = ["+nightly", "llvm-cov"]

[job."llvm-cov"]
command = "cargo"
args = ["+nightly", "llvm-cov", "--lcov", "--output-path", "target/lcov.info"]

[job."live-llvm-cov:html"]
mode = "parallel"
jobs = ["serve:llvm-cov:html", "llvm-cov:html:watch"]

[job."llvm-cov:html:watch"]
visibility = "private"
mode = "watch"
job = "llvm-cov:html"
watch_list = ["src/*", "src/**", "Cargo.toml"]

[job."llvm-cov:html:serve"]
visibility = "private"
command = "npx"
args = [
  "browser-sync",
  "start",
  "--server",
  "target/llvm-cov/html",
  "--files",
  "target/llvm-cov/html/**",
  "--no-open",
]

[job."llvm-cov:html"]
visibility = "private"
command = "cargo"
args = ["+nightly", "llvm-cov", "--html", "--no-clean"]

[job.live-test]
mode = "watch"
job = "only-test"
watch_list = ["src/**", "Cargo.toml"]

[job.live-run]
mode = "watch"
job = "run"
watch_list = ["src/**", "Cargo.toml"]

[job.test-run]
mode = "sequential"
jobs = ["only-test", "run"]

[job.run]
command = "cargo"
args = ["run"]
description = "run the project"

[job.only-test]
command = "cargo"
args = ["test", "--release"]
description = "run the tests"

[job.only-build]
command = "cargo"
args = ["build"]

[job.only-install]
command = "cargo"
args = ["install", "--path", "."]

[job.test-build]
mode = "parallel"
jobs = ["only-test", "only-build"]

[job.git-pull]
command = "git"
args = ["pull"]
